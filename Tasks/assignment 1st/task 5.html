<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task 5: Product Search Filter</title>
    <style>
      * {
        margin: 0%;
        padding: 0%;
        box-sizing: border-box;
      }
      body {
        background-color: black;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        flex-direction: column;
        gap: 2rem;
        font-family: monospace;
      }
      .flex-center {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .flex-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .flex-around {
        display: flex;
        justify-content: space-around;
        align-items: center;
      }
      .flex-evenly {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
      }

      #searchBox {
        margin: 50px 0px;
        padding: 10px 20px;
        border-radius: 50px;
        font-size: 20px;
      }
      .container {
        max-width: 1300px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 30px;
      }
      .card {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        flex-direction: column;
        border: 2px solid white;
        border-radius: 50px;
        overflow: hidden;
        transition: transform 300ms ease 5ms;
        width: 250px;
        /* height: 500px; */
        position: relative;
      }
      .card img {
        width: 250px;
        height: 350px;
      }
      .card:hover {
        transform: translateY(-10px);
        box-shadow: 5px 5px 20px white;
      }
      .rating {
        position: absolute;
        top: 5%;
        left: 8%;
        background-color: rgba(255, 0, 0, 0.7);
        border-radius: 50px;
        padding: 5px 10px;
      }
      .price {
        padding: 8px 15px;
        background-color: greenyellow;
        color: black;
        border-radius: 50px;
        font-size: 15px;
        font-weight: 900;
      }
      .product-info {
        padding: 15px 20px;
        gap: 20px;
      }
      .title {
        font-size: 15px;
      }
    </style>
  </head>
  <body>
    <form>
      <input
        type="search"
        id="searchBox"
        placeholder="Search products"
        autocomplete="off"
      />
    </form>

    <div class="container"></div>

    <script>
      const shortenTitle = (title, maxLength = 15) =>
        title.length > maxLength ? title.slice(0, maxLength) + "...." : title;

      // Debounce helper
      function debounce(fn, delay = 300) {
        let timeoutId;
        return function (...args) {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => fn.apply(this, args), delay);
        };
      }

      let allProducts = [];

      // Fetch products once
      const fetchData = async () => {
        const response = await fetch("https://fakestoreapi.com/products");
        const products = await response.json();
        allProducts = products;
        return products;
      };

      // DOM container
      const container = document.querySelector(".container");

      // Render function
      const renderProducts = (products) => {
        container.innerHTML = "";

        if (!products || products.length === 0) {
          const p = document.createElement("p");
          p.textContent = "No products found.";
          p.style.padding = "1rem";
          p.style.fontSize = "18px";
          container.appendChild(p);
          return;
        }

        products.forEach((product) => {
          const card = document.createElement("div");
          card.classList.add("card");

          const image = document.createElement("img");
          image.src = product.image;
          image.alt = product.title;

          const ratings = document.createElement("span");
          ratings.classList.add("rating");
          ratings.textContent = "⭐️ " + product.rating.rate;

          const productInfo = document.createElement("div");
          productInfo.classList.add("product-info", "flex-center");

          const price = document.createElement("span");
          price.classList.add("price");
          price.textContent = "$" + product.price;

          const title = document.createElement("p");
          title.classList.add("title");
          title.textContent = shortenTitle(product.title);

          productInfo.append(price, title);
          card.append(image, ratings, productInfo);
          container.appendChild(card);
        });
      };

      const searchBox = document.getElementById("searchBox");

      const handleSearch = (event) => {
        const q = event.target.value.trim().toLowerCase();

        if (!q) {
          renderProducts(allProducts);
          return;
        }

        const filtered = allProducts.filter((p) =>
          p.title.toLowerCase().includes(q)
        );

        renderProducts(filtered);
      };

      const debouncedSearch = debounce(handleSearch, 300);
      searchBox.addEventListener("input", debouncedSearch);

      document.addEventListener("DOMContentLoaded", async () => {
        try {
          await fetchData();
          renderProducts(allProducts);
        } catch (err) {
          container.innerHTML =
            "<p style='padding:1rem'>Failed to load products.</p>";
          console.error(err);
        }
      });
    </script>
  </body>
</html>
